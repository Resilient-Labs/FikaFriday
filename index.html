<html>

<head>
    <link rel="stylesheet" href="fika.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
    <!-- 
		HERE'S SOME NEW STUFF!!
 -->
    <div class="container" id="text-container">
        <h1>Fika Friday</h1>
        <h2>This week's prompt</h2>
        <textarea id="textarea"></textarea>
    </div>
    <div class="container" id="pairs-container">

        <div id="splash">
            <h2>Participants</h2>
            <div class='square' id='add_user'> Add </div>
            <button onclick="pairM()"> Make Pairs </button>
        </div>
        <div class='' id='splash2'>
            <h2>Pairs</h2>
            <button onclick="slack()"> Send </button>
        </div>

    </div>

    <script>
        //Adding User

        var add_u = document.getElementById("add_user");
        add_u.addEventListener("click", function () {

            var new_user = {
                first: prompt('Enter First Name'),
                last: prompt('Enter Last Name'),
            }

            employee.push(new_user)
            drawE_square(new_user)

        });

        var employee = [
            {
                'first': 'Lee-Bron',
                'last': 'James',
                'selected': true,
                // 'email': 'LB.Cavs@hotmailcom',
                // 'slack': 'Cavs SF',
	  			},
            {
                'first': 'Kevin',
                'last': 'Durant',
                'selected': true,
                // 'email': 'KD.Thunder@gmailcom',
                // 'slack': 'OKC SF',
			 	},
            {
                'first': 'Ka-Why',
                'last': 'Lard',
                'selected': true,
                // 'email': 'KL.Spurs@gmailcom',
                // 'slack': 'Spurs SF',
			 	},
            {
                'first': 'Melo',
                'last': 'Antt',
                'selected': true,
                // 'email': 'Melo.Knicks@gmailcom',
                // 'slack': 'Knicks SF',
			 	},
            {
                'first': 'Paul',
                'last': 'George',
                'selected': true,
                // 'email': 'PG.13@gmailcom',
                // 'slack': 'PG13 SF',
			 	},
            {
                'first': 'Gorden',
                'last': 'Hayward',
                'selected': true,
                // 'email': '',
                // 'slack': '',
	  			},
            {
                'first': 'Ruby',
                'last': 'Lay',
                'selected': true,
                // 'email': '',
                // 'slack': '',
	  			},
            {
                'first': 'Tyreck',
                'last': 'Evans',
                'selected': true,
                // 'email': '',
                // 'slack': '',
	  			},
            {
                'first': 'Michael',
                'last': 'Jordan',
                // 'email': '',
                'selected': true,
                // 'slack': '',
	  			},
            {
                'first': 'Jerry',
                'last': 'West',
                'selected': true,
                // 'email': '',
                // 'slack': '',
	  			},
				];

        var pairX = [

				];
        //Added this to determine whether or not to add things to splash or splash2
        var drawE_square = function (object, container) {

            var square = document.createElement("div");
            square.className = ("square");

            square.addEventListener("click",
                function fade(drawE_square) {
                    for (i = 0; i < employee.length; i++) {
                        var name = employee[i].first + " " + employee[i].last
                        if (name === square.children[0].innerHTML) {
                            //check to see if the square is faded
                            if (square.style.opacity == 0.5) {
                                square.style.opacity = 1
                                employee[i].selected = true
                                console.log("This Should Be Unfaded")
                            } else {
                                employee[i].selected = false
                                square.style.opacity = 0.5
                                console.log("This square should be Fading")

                            }

                            console.log(employee[i])
                        }

                    }

                }
            );

            var first = document.createElement('p');
            var second = document.createTextNode(object.first + ' ' + object.last);
            first.appendChild(second);

            square.appendChild(first);
            //Editing User

            var third = document.createElement('a');
            var fourth = document.createTextNode('Edit');
            third.appendChild(fourth);

            square.appendChild(third);

            third.addEventListener("click", function (event) {
                object.first = prompt('Enter First Name');
                object.last = prompt('Enter Last Name');
                event.stopPropagation();
                second = document.createTextNode(object.first + ' ' + object.last);
                first.appendChild(second);
            });
            //Added this to determine whether or not to add things to splash or splash2
            var element = document.getElementById("" + container);
            element.appendChild(square);

        };

        //Pairing Functionality
        var pairM = function () {
                var confirmation = true,
                    dummy = [];
                for (i = 0; i < employee.length; i++) {
                    if (employee[i].selected == true) {
                        dummy.push(employee[i]);
                    }
                }
                //Checks to see if there are an even number of Employees
                if (dummy.length % 2 > 0) {
                    confirmation = confirm("There's an odd number of people selected, and someone will be alone. Is that cool?");
                }
                if (confirmation) {

                    var group = dummy.length
                    for (i = 0; i < group / 2; i++) {
                        var random = Math.floor(Math.random() * (dummy.length - 2)) + 1;
                        var pairS = [
                                            dummy[0],
                                            dummy[random]
                                        ]


                        dummy.splice(random, 1)
                        dummy.splice(0, 1)

                        pairX.push(pairS);
                    };
                    console.log("This week's pairs are: ");
                    console.log(pairX);
                    //Create splash2
                    //Loop through pairX, and draw each square (drawE_square)
                    for (i = 0; i < pairX.length; i++) {
                        var grow = 0;
                        drawE_square(pairX[i][grow], "splash2");
                        grow++;
                        drawE_square(pairX[i][grow], "splash2");


                    }
                    //Move splash1 over
                    var splash1 = document.getElementById("splash");
                    splash1.className += splash1.className ? ' moved' : 'moved';
                    //Move splash2 over
                    var splash2 = document.getElementById("splash2");
                    splash2.className += splash2.className ? ' moved' : 'moved';
                } else {
                    console.log("pairing aborted due to uneven numbers");
                }

            }
            //Draws all the squares
        for (i = 0; i < employee.length; i++) {
            //Added this to determine whether or not to add things to splash or splash2
            drawE_square(employee[i], "splash");
        }
        //Slack Integration
        var slack = function () {
            
            var message = document.getElementById("textarea").value;
            var slackMesage = "This week's Fika Friday Message is: "+ message +".\n Here are the pairs: \n";
            for(i = 0; i<pairX.length; i++){
                slackMesage += "" + pairX[i][0].first + " and " + pairX[i][1].first + "\n";
            }
            $.ajax({
                type: 'POST',
                url: 'https://hooks.slack.com/services/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',
                data: JSON.stringify({
                    "text": "This week's Fika Friday Message is: "+ message +".\n Here are the pairs: \n"
                }),
                async: false,
                //     dataType: 'json',
                success: function (data) {
                    console.log("fucking nailed it");
                },
                error: function (t, e) {
                    console.log("You're so close!! " + e);
                },
                processData: false

            });
        };
    </script>

</body>

</html>